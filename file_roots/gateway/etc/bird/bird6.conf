# This file is managed by Salt, do not edit.

# Change this into your BIRD router ID. It's a world-wide unique identification
# of your router, usually one of router's IPv4 addresses.
# Unsere externe feste IPv4-Adresse: {{ pillar['network']['primary']['address'] }}
router id {{ pillar['network']['primary']['address'] }};

# Our Autonomous System Number from Freifunk Rheinland
define myas = {{ pillar['bird']['myas'] }};

### functions ###

function net_ffrl() {
    return net ~ [ 2a03:2260:3010::/48+ ];
}

function ip6_default() {
    return net ~ [ ::/0 ];
}

# The Device protocol is not a real routing protocol. It doesn't generate any
# routes and it only serves as a module for getting information about network
# interfaces from the kernel.
protocol device {
    scan time 10;
}

# The Kernel protocol is not a real routing protocol. Instead of communicating
# with other routers in the network, it performs synchronization of BIRD's
# routing tables with the OS kernel.
protocol kernel {
    kernel table 61;
    scan time 10;
    import none;
    export filter {
        if ip6_default() then accept;
        reject;
    };
};

### static routes for bgp ###

protocol static {
    route 2a03:2260:11f::/48 reject;
}

### templates for BGP ###

template bgp ffrl_upstream {
    # local as {{ pillar['bird']['myas'] }};
    local as myas;
    import where ip6_default();
    export where net_ffrl();
    direct;
}

# Logging
# log "/var/log/bird.log" all;
# log syslog all;

# Include Freifunk Rheinland IPv6 Upstream
# include "/etc/bird/ffrl_upstream_v6.conf";

# Freifunk Rheinland Upstream IPv6

# Endpoint bb-a.ak.ber
protocol bgp ffrl_ber_a from ffrl_upstream {
    description "bb-a.ak.ber";
    neighbor 2a03:2260:0:a9::1 as 201701;
}

# Endpoint bb-b.ak.ber
protocol bgp ffrl_ber_b from ffrl_upstream {
    description "bb-b.ak.ber";
    neighbor 2a03:2260:0:ab::1 as 201701;
}

# Endpoint bb-a.ix.dus
protocol bgp ffrl_dus_a from ffrl_upstream {
    description "bb-a.ix.dus";
    neighbor 2a03:2260:0:aa::1 as 201701;
}

# Endpoint bb-b.ix.dus
protocol bgp ffrl_dus_b from ffrl_upstream {
    description "bb-b.ix.dus";
    neighbor 2a03:2260:0:ac::1 as 201701;
}

# Endpoint bb-a.fra3.fra
# protocol bgp ffrl_fra_a from ffrl_upstream {
#     description "bb-a.fra3.fra";
#     neighbor 2a03:2260:0:126::1 as 201701;
# }

# Endpoint bb-b.fra3.fra
# protocol bgp ffrl_fra_b from ffrl_upstream {
#     description "bb-b.fra3.fra";
#     neighbor 2a03:2260:0:127::1 as 201701;
# }

